<?xml version="1.0" encoding="UTF-8" ?>
<odoo>
	<data>

		<!-- Menus -->

		<menuitem name="Wage Adustments" id="submenu_hr_wageadjust"
				  parent="hr_payroll.menu_hr_payroll_root" sequence="90" groups="hr.group_hr_user" />

		<record id="view_hr_wage_increment_filter" model="ir.ui.view">
			<field name="name">view_hr_wage_increment_filter</field>
			<field name="model">hr.contract.wage.increment</field>
			<field name="arch" type="xml">
				<search string="Wage Adjustment Search">
					<filter icon="terp-camera_test" domain="[('state','in',('draft', 'confirm'))]"
							string="To Approve" name="to_approve" />
					<filter name="done" icon="terp-camera_test" string="Done"
							domain="[('state','=','approve')]" />
					<separator/>
                    <filter string="Active Employees Adjustments" name="active_employees_adjustments" domain="[('employee_id.active','=',True)]"/>
                    <filter string="Inactive Employees Adjustments" name="inactive_employees_adjustments" domain="[('employee_id.active','=',False)]"/>
					<newline />
					<field name="effective_date" />
					<field name="employee_id" />
					<field name="department_id" />
					<field name="job_id" />
					<newline />
					<filter string="My Department Adjustments" icon="terp-personal+"
							domain="[('department_id.manager_id','=',uid)]" />
					<group expand="0" string="Group By...">
						<filter name="department" string="Department" icon="terp-personal"
								domain="[]" context="{'group_by':'department_id'}" />
						<filter name="job" string="Job" icon="terp-personal"
								domain="[]" context="{'group_by':'job_id'}" />
						<filter name="employee" string="Employee" icon="terp-personal"
								domain="[]" context="{'group_by':'employee_id'}" />
						<filter name="date" icon="terp-go-today" domain="[]"
								context="{'group_by':'effective_date'}" />
						<filter name="state" string="State" icon="terp-go-today"
								domain="[]" context="{'group_by':'state'}" />
					</group>
				</search>
			</field>
		</record>

		<record id="wage_increment_view_tree" model="ir.ui.view">
			<field name="name">hr.contract.wage.increment.tree</field>
			<field name="model">hr.contract.wage.increment</field>
			<field name="arch" type="xml">
				<tree string="Wage Adjustments" create="false">
					<field name="employee_id" />
					<field name="department_id" />
					<field name="job_id" />
					<field name="c_wage" />
					<field name="wage" />
					<field name="wage_difference" />
					<field name="wage_difference_percent" />
					<field name="effective_date" />
					<field name="state" />
				</tree>
			</field>
		</record>

		<record id="open_wage_increment" model="ir.actions.act_window">
			<field name="name">Individual</field>
			<field name="res_model">hr.contract.wage.increment</field>
			<field name="view_type">form</field>
			<field name="view_mode">tree,form</field>
			<field name="search_view_id" ref="view_hr_wage_increment_filter" />
			<field name="context">{
				'search_default_to_approve':1}
			</field>
		</record>
		<menuitem action="open_wage_increment" id="menu_wage_increment"
				  parent="submenu_hr_wageadjust" groups="hr.group_hr_user" sequence="10" />


		<record id="wage_increment_view_popup" model="ir.ui.view">
			<field name="name">hr.contract.wage.increment.form</field>
			<field name="model">hr.contract.wage.increment</field>
			<field name="arch" type="xml">
				<form string="Wage Adjustment">
					<header>
						<button name="do_signal_confirm" type="object" states="draft"
								string="Confirm" class="oe_highlight" />
						<button name="do_signal_approve" type="object" states="confirm"
							string="Approve" class="oe_highlight" />
						<button name="do_signal_decline" type="object" states="confirm"
							string="Decline" class="oe_highlight" />
						<field name="state" widget="statusbar" readonly="1"/>
					</header>
					<sheet>
						<group>
							<group string="New Contract">
								<field name="wage" required="1"
									   attrs="{'readonly': [('state','!=','draft')]}"/>
								<field name="effective_date" required="1"
									   attrs="{'readonly': [('state','!=','draft')]}"/>
								<field name="wage_difference" readonly="1"/>
							</group>
							<group string="Current Contract">
								<field name="employee_id" readonly="1"/>
								<field name="contract_id" readonly="1"/>
								<field name="c_wage" readonly="1"/>
							</group>
							<group string="Miscellaneous">
								<field name="department_id" readonly="1"/>
								<field name="job_id" readonly="1"/>
								<field name="run_id" />
							</group>
						</group>
					</sheet>
				</form>
			</field>
		</record>
		<act_window name="Wage Adjustment" res_model="hr.contract.wage.increment"
					src_model="hr.employee" view_mode="form" view_id="wage_increment_view_popup"
					target="new" id="wage_increment_act_window" groups="hr_payroll.group_hr_payroll_user"/>

		<!-- wage adjustment runs -->

		<record id="wage_adjustment_run_filter" model="ir.ui.view">
			<field name="name">hr.contract.wage.increment.run.search</field>
			<field name="model">hr.contract.wage.increment.run</field>
			<field name="arch" type="xml">
				<search string="Search Wage Adjustment Batches">
					<field name="name" string="Adjustment Batches" />
					<field name="effective_date" />
					<filter icon="terp-camera_test" domain="[('state','in',('draft', 'confirm'))]"
							string="To Approve" name="to_approve" />
					<filter name="done_filter" icon="terp-camera_test" string="Done"
							domain="[('state','=','approve')]" help="Approved Adjustment Batches" />
					<group expand="0" string="Group By...">
						<filter name="state" string="State" icon="terp-go-today"
								domain="[]" context="{'group_by':'state'}" />
						<filter name="date" string="Date" icon="terp-go-today"
								domain="[]" context="{'group_by':'effective_date'}" />
					</group>
				</search>
			</field>
		</record>

		<record id="wage_adjustment_run_tree" model="ir.ui.view">
			<field name="name">hr.contract.wage.increment.run.tree</field>
			<field name="model">hr.contract.wage.increment.run</field>
			<field name="arch" type="xml">
				<tree string="Wage Adjustment Batches">
					<field name="name" />
					<field name="effective_date" />
					<field name="type" />
					<field name="adjustment_amount" />
					<field name="state" />
				</tree>
			</field>
		</record>

		<record id="wage_adjustment_run_form" model="ir.ui.view">
			<field name="name">hr.contract.wage.increment.run.form</field>
			<field name="model">hr.contract.wage.increment.run</field>
			<field name="arch" type="xml">
				<form string="Wage Adjustment Batch">
					<header>
						<button name="%(action_wage_adjustment_by_employees)d"
								type="action" states="draft" string="Generate Adjustments" class="oe_highlight" groups="hr_payroll.group_hr_payroll_user"/>
						<button name="state_confirm" type="object" string="Confirm"
								states="draft" class="oe_highlight" groups="hr_payroll.group_hr_payroll_user"/>
						<button name="state_approve" type="object" string="Approve"
								states="confirm" class="oe_highlight" groups="hr_payroll.group_hr_payroll_user"/>
						<button name="state_decline" type="object" string="Decline"
								states="confirm" class="oe_highlight" groups="hr_payroll.group_hr_payroll_user"/>
						<field name="state" widget="statusbar" readonly="1"/>
					</header>
					<sheet>
						<label for="name" class="oe_edit_only" />
						<h1>
							<field name="name" required="1"
								   attrs="{'readonly':[('state','!=','draft')]}"/>
						</h1>
						<h2>
							Effective Date
							<field name="effective_date" required="1"
								   attrs="{'readonly':[('state','!=','draft')]}"/>
						</h2>
						<group>
							<field name="type" required="1"
								   attrs="{'readonly':[('state','!=','draft')]}"/>
							<field name="adjustment_amount" required="1"
								   attrs="{'invisible': [('type','=','manual')], 'readonly':[('state','!=','draft')]}" />
						</group>
						<separator string="Adjustments" />
						<field name="increment_ids" nolabel="1">
							<tree string="Wage Adjustments" editable="bottom" create="false">
								<field name="employee_id" />
								<field name="department_id" />
								<field name="c_wage" />
								<field name="wage" />
								<field name="wage_difference" />
								<field name="wage_difference_percent" />
								<field name="effective_date" />
								<field name="state" />
							</tree>
						</field>
					</sheet>
				</form>
			</field>
		</record>

		<record id="action_wage_adjustment_run" model="ir.actions.act_window">
			<field name="name">Batch</field>
			<field name="res_model">hr.contract.wage.increment.run</field>
			<field name="view_type">form</field>
			<field name="view_id" ref="wage_adjustment_run_tree" />
			<field name="search_view_id" ref="wage_adjustment_run_filter" />
			<!-- <field name="context">{'default_type': 'to_approve', 'search_default_to_approve':1}</field> -->
		</record>
		<menuitem action="action_wage_adjustment_run" id="menu_wage_adjustment_run"
				  parent="submenu_hr_wageadjust" groups="hr.group_hr_user" sequence="20" />

		<!-- Employee Wage History -->

		<record id="act_hr_employee_2_hr_wage_adjustment" model="ir.actions.act_window">
			<field name="res_model">hr.contract.wage.increment</field>
			<field name="view_type">form</field>
			<field name="name">Wage History</field>
			<field name="view_mode">tree,form</field>
			<field name="context">{'search_default_employee_id': [active_id],
				'default_employee_id': active_id}
			</field>
		</record>
		<record id="hr_employee_view_form" model="ir.ui.view">
			<field name="name">hr.employee.view.inherit.wage.increment</field>
			<field name="model">hr.employee</field>
			<field name="inherit_id" ref="hr.view_employee_form" />
			<field name="arch" type="xml">
				<data>

					<xpath expr="//div[@name='button_box']" position="inside">
						<button name="%(act_hr_employee_2_hr_wage_adjustment)d"
								class="oe_stat_button" icon="fa-book" type="action" groups="hr_payroll_customization.group_payroll_auditor" >
							<field name="wage_count" widget="statinfo" string="Wage History"
								   help="wage" />

						</button>
					</xpath>
				</data>
			</field>
		</record>

	</data>
</odoo>