<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record model="ir.ui.view"
            id="view_company_inherit_for_expense_policy">
        <field name="name">res.company.group_email.inherit.expense</field>
        <field name="inherit_id"
               ref="service_configuration_panel.view_company_inherit_for_service_panel"/>
        <field name="model">res.company</field>
        <field name="arch" type="xml">
            <xpath expr="//page[@name='policies']"
                   position="inside">
                <group string="Expense Policy">
                    <field name="expense_policy_id" invisible="1"/>
                </group>
            </xpath>
        </field>
    </record>

    <!-- Inherit Form View to Modify it -->
    <record id="expense_form_view_inherit_service_panel" model="ir.ui.view">
        <field name="name">expense.sheet.service.panel.inherit</field>
        <field name="model">hr.expense.sheet</field>
        <field name="inherit_id" ref="hr_expense.view_hr_expense_sheet_form"/>
        <field name="arch" type="xml">

            <xpath
                    expr="//form/sheet/div[@class='oe_title']"
                    position="attributes">
                <attribute name="invisible">1</attribute>

            </xpath>
            <xpath expr="//form/header" position="replace">
                <header>
                    <field name="state" widget="statusbar" invisible="1"/>
                    <field name="stage_id" widget="statusbar"/>
                    <button name="action_submit_for_expense_approval"
                            type="object"
                            string="Submit for Approval "
                            class="btn-primary"
                            groups="org_expenses_extension.group_expense_normal_user"
                            states="submit"/>
                    <!-- Manager -->
                    <button name="expense_service_validate1" type="object"
                            string="Manager Approval " class="btn-primary"
                            groups="org_expenses_extension.group_expense_manager_approval"
                            states="mngr_approval"/>
                    <button
                            name="%(service_configuration_panel.act_open_service_log_wizard)d"
                            type="action"
                            string="Reject" class="o_sale_confirm"
                            groups="org_expenses_extension.group_expense_manager_approval"
                            states='mngr_approval'
                            context="{'trigger': 'Rejected'}"/>
                    <!-- VP -->
                    <button name="expense_service_validate2" type="object"
                            states="vp_approval"
                            groups="org_expenses_extension.group_expense_vp_approval"
                            string="VP Approval" class="btn-primary"/>
                    <button
                            name="%(service_configuration_panel.act_open_service_log_wizard)d"
                            type="action"
                            string="Reject" class="o_sale_confirm"
                            groups="org_expenses_extension.group_expense_vp_approval"
                            states='vp_approval'
                            context="{'trigger': 'Rejected'}"/>
                    <!-- Budget Approval -->
                    <button name="expense_service_validate3" type="object"
                            states="budget_approval"
                            groups="org_expenses_extension.group_expense_budget_approval"
                            string="Budget Approval" class="btn-primary"/>
                    <button
                            name="%(service_configuration_panel.act_open_service_log_wizard)d"
                            type="action"
                            string="Reject" class="o_sale_confirm"
                            states='budget_approval'
                            groups="org_expenses_extension.group_expense_budget_approval"
                            context="{'trigger': 'Rejected'}"/>
                    <!-- HR -->
                    <button name="expense_service_validate4" type="object"
                            string="HR Approval" class="btn-primary"
                            groups="org_expenses_extension.group_expense_hr_approval"
                            states="hr_approval"/>
                    <button
                            name="%(service_configuration_panel.act_open_service_log_wizard)d"
                            type="action"
                            string="Reject" class="o_sale_confirm"
                            states='hr_approval'
                            groups="org_expenses_extension.group_expense_hr_approval"
                            context="{'trigger': 'Rejected'}"/>
                    <!-- CEO -->
                    <button name="expense_service_validate5" type="object"
                            string="CEO Approval" class="btn-primary"
                            groups="org_expenses_extension.group_expense_ceo_approval"
                            states="ceo_approval"/>
                    <button
                            name="%(service_configuration_panel.act_open_service_log_wizard)d"
                            type="action"
                            string="Reject" class="o_sale_confirm"
                            states='ceo_approval'
                            groups="org_expenses_extension.group_expense_ceo_approval"
                            context="{'trigger': 'Rejected'}"/>
                    <button name="action_sheet_move_create"
                            states="approve"
                            string="Post Journal Entries"
                            type="object"  class="oe_highlight o_expense_sheet_post"/>
                    <button name="%(hr_expense.hr_expense_register_payment_wizard_action)d" type="action" string="Register Payment" class="oe_highlight o_expense_sheet_pay" attrs="{'invisible': [('state', '!=', 'post')]}" context="{'default_amount': total_amount, 'partner_id': address_id}"/>
                </header>
            </xpath>
            <xpath expr="/form/sheet/group[1]" position="replace">
                <h1 class="mt0">
                    <field name="name" readonly="1" class="oe_inline"/>
                </h1>
                <group>
                    <group>
                        <field name="employee_id"
                               required="1"/>
                        <field name="job_id"  readonly="1"/>
                        <field name="org_unit_type_expe"  readonly="1"/>
                        <field name="expense_approval_policy_id"/>
                        <field name="about_expense" readonly="1" widget="html"/>
                    </group>

                    <group>
                        <field name="employee_company_id" readonly="1"/>
                        <field name="company_id"  readonly="1"/>
                        <field name="department_id"  readonly="1"/>
                        <field name="expense_summary"/>
                    </group>
                </group>
                <group>
                    <group>
                        <field name="payment_mode"/>
                        <field name="journal_id"
                               domain="[('type', '=', 'purchase')]"
                               options="{'no_open': True, 'no_create': True}" attrs="{'invisible': [('state', '!=', 'post')]}"/>
                    </group>

                    <group>
                        <field name="accounting_date" groups="account.group_account_user"/>
                    </group>
                </group>
                <group>
                    <group>
                        <field name="responsible_id" invisible="1"/>
                        <field name="total_amount" invisible="1"/>
                        <field name="currency_id" invisible="1"/>
                        <field name="address_id" invisible="1"/>
                    </group>
                    <group>
                        <field name="bank_journal_id" groups="account.group_account_user" options="{'no_open': True, 'no_create': True}" attrs="{'invisible': [('payment_mode', '!=', 'company_account')]}" domain="[('type', 'in', ['cash', 'bank'])]"/>
                        <field name="account_move_id" invisible="1"/>
                    </group>
                </group>
                <group>
                    <field name="endorsement_expense_required" invisible="1"/>
                </group>
            </xpath>
            <!--<xpath expr="//sheet/field[@name='expense_line_ids']"-->
            <!--position="replace">-->
            <!--</xpath>-->
            <!--<xpath expr="//form/sheet/field[@name='expense_line_ids']"-->
            <!--position="attributes">-->
            <!--<attribute name="invisible">1</attribute>-->
            <!--</xpath>-->
            <field name="expense_line_ids" position="replace"/>
            <xpath expr="//sheet"
                   position="inside">
                <notebook>
                    <page name="expense_lines" string="Expense Details">
                        <div>

                        </div>
                        <div>
                            Add Expenses Lines here by clicking this button
                            <button name="add_expense_line" string="Add Expenses"
                                    type="object" states="submit"/>
                        </div>

                        <br/>
                        <field name="expense_line_ids" widget="many2many"
                               nolabel="1"
                               options="{'not_delete': True}" readonly="1">
                            <tree editable="bottom">
                                <field name="product_id" readonly="0"/>
                                <field name="unit_amount"/>
                                <field name="quantity"/>
                                <field name="product_uom_id"/>
                                <field name="date"/>
                                <field name="payment_mode"/>
                                <field name="account_id"/>
                                <field name="analytic_account_id"/>
                                <field name="tax_ids" widget="many2many_tags"/>
                                <field name="total_amount" sum="Total Amount" widget="monetary"/>
                                <field name="name" invisible="1"/>
                                <field name="state" invisible="1"/>
                                <field name="message_unread" invisible="1"/>
                                <field name="attachment_number" invisible="1"/>
                                <field name="attachment_number" string=" "/>
                                <button name="action_get_attachment_view" string="View Attachments" type="object" icon="fa paperclip"/>
                            </tree>
                        </field>
                    </page>
                    <page string="Endorsement" name="expense_endorsement"
                          attrs="{'invisible':[('endorsement_expense_required','=',False)]}">
                        <group>
                            <field name="endorsement_expense_text" nolabel="1"
                                   widget="html"/>
                        </group>
                        <group>
                            <field name="endorsement_expense_approved"/>
                        </group>
                    </page>
                    <!--Approvals Page-->
                    <page string="Approvals"
                          name="expense_approvals">
                        <div>
                            The approval/refusal information will be
                            displayed here.
                        </div>
                        <group>
                            <group
                                    attrs="{'invisible':[('expense_mngr_user_id','=',False)]}">
                                <field name="expense_mngr_user_id"
                                       options="{'no_open': True,'no_create': True,'no_quick_create': True,'no_create_edit': True, 'limit':1000}"/>
                                <field name="expense_mngr_approval_date"/>
                            </group>
                            <group
                                    attrs="{'invisible':[('expense_vp_user_id','=',False)]}">
                                <field name="expense_vp_user_id"
                                       options="{'no_open': True,'no_create': True,'no_quick_create': True,'no_create_edit': True, 'limit':1000}"/>
                                <field name="expense_vp_approval_date"/>
                            </group>
                            <group
                                    attrs="{'invisible':[('expense_hr_user_id','=',False)]}">
                                <field name="expense_hr_user_id"
                                       options="{'no_open': True,'no_create': True,'no_quick_create': True,'no_create_edit': True, 'limit':1000}"/>
                                <field name="expense_hr_approval_date"/>
                            </group>
                            <group
                                    attrs="{'invisible':[('expense_ceo_user_id','=',False)]}">
                                <field name="expense_ceo_user_id"
                                       options="{'no_open': True,'no_create': True,'no_quick_create': True,'no_create_edit': True, 'limit':1000}"/>
                                <field name="expense_ceo_approval_date"/>
                            </group>
                            <group
                                    attrs="{'invisible':[('expense_rejected_user_id','=',False)]}">
                                <field name="expense_rejected_user_id"
                                       options="{'no_open': True,'no_create': True,'no_quick_create': True,'no_create_edit': True, 'limit':1000}"/>
                                <field name="expense_rejected_date"/>
                            </group>
                            <group colspan="4" col="4"
                                   attrs="{'invisible':[('expense_submitted_by','=',False)]}">
                                <field name="expense_submitted_by" colspan="2"
                                       options="{'no_open': True,'no_create': True,'no_quick_create': True,'no_create_edit': True, 'limit':1000}"/>
                                <field name="expense_submit_date"
                                       colspan="2"/>
                            </group>
                            <group attrs="{'invisible':[('expense_submitted_by','=',False)]}"
                                   colspan="4" col="4">
                                <field name="expense_waiting_time"
                                       colspan="2"/>
                                <field name="expected_approval_date_as_sla"
                                       attrs="{'invisible': [('expected_approval_date_as_sla','=', False)]}"/>
                            </group>
                        </group>
                    </page>
                    <page name="service_logs" string="Service Logs">
                        <field name="expense_service_log_ids" readonly="1">
                            <tree string="Service Logs">
                                <field name="expense_request_id"
                                       invisible="1"/>
                                <field name="user_id"/>
                                <field name="activity_datetime"
                                       readonly="1"/>
                                <field name="state_from"/>
                                <field name="state_to"/>
                                <field name="reason"/>
                            </tree>
                        </field>
                    </page>
                </notebook>
                <group>
                    <group class="oe_subtotal_footer oe_right" colspan="2" name="expense_total">
                        <field name="total_amount" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                    </group>
                </group>
            </xpath>
        </field>
    </record>

    <!-- Inherit Form View to Modify it -->
    <record id="expense_form_view_inherit_for_fooer" model="ir.ui.view">
        <field name="name">hr.expense.form</field>
        <field name="model">hr.expense</field>
        <field name="inherit_id" ref="hr_expense.hr_expense_form_view"/>
        <field name="arch" type="xml">

            <xpath expr="//form/sheet" position="after">
                <footer>
                    <button name="create_expense_line" string="Save"
                            type="object"/>
                    <button string="Cancel" class="btn-default"
                            special="cancel"/>
                </footer>
            </xpath>

        </field>
    </record>


</odoo>
