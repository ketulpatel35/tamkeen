<?xml version="1.0" encoding="utf-8" ?>
<odoo>

    <record id="account_invoice_prepayment_view" model="ir.ui.view">
        <field name="name">account.invoice.prepayment.view</field>
        <field name="model">account.invoice</field>
        <field name="inherit_id" ref="account.invoice_form"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='user_id']" position="after">
                <field name="prepayment" attrs="{'readonly':[('state','!=','draft')]}"
                    context="{'lines':invoice_line_ids}"/>
                <field name="prepayment_type_id" context="{'lines':invoice_line_ids}"
                    attrs="{'required':[('prepayment','=',True)],'invisible':[('prepayment','=',False)],
                            'readonly':[('state','!=','draft')]}"
                    domain="[('type','=','revenue')]"/>
            </xpath>
        </field>
    </record>

    <record id="vendor_bill_prepayment_view" model="ir.ui.view">
        <field name="name">vendor.bill.prepayment.view</field>
        <field name="model">account.invoice</field>
        <field name="inherit_id" ref="account.invoice_supplier_form"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='date_due']" position="after">
                <field name="prepayment" attrs="{'readonly':[('state','!=','draft')]}" context="{'lines':invoice_line_ids}"/>
                <field name="prepayment_type_id" context="{'lines':invoice_line_ids}"
                    attrs="{'required':[('prepayment','=',True)],'invisible':[('prepayment','=',False)],
                            'readonly':[('state','!=','draft')]}"
                    domain="[('type','=','expense')]"/>
            </xpath>
        </field>
    </record>

    <record id="account.menu_finance" model="ir.ui.menu">
        <field name="groups_id" eval="[
           (4, ref('account_prepayment.group_prepayment_expense')),
            (4, ref('account_prepayment.group_deferred_revenue')),
            (4, ref('account_prepayment.group_prepayment_type_user')),
            (4, ref('account_prepayment.group_prepayment_type_manager'))
        ]"/>
    </record>

    <record id="account.menu_finance_entries" model="ir.ui.menu">
        <field name="groups_id" eval="[
           (4, ref('account_prepayment.group_prepayment_expense')),
            (4, ref('account_prepayment.group_deferred_revenue'))
        ]"/>
    </record>

    <record id="account.menu_finance_configuration" model="ir.ui.menu">
        <field name="groups_id" eval="[
           (4, ref('account_prepayment.group_prepayment_type_user')),
            (4, ref('account_prepayment.group_prepayment_type_manager'))
        ]"/>
    </record>

    <record id="account.account_account_menu" model="ir.ui.menu">
        <field name="groups_id" eval="[
           (4, ref('account_prepayment.group_prepayment_type_user')),
            (4, ref('account_prepayment.group_prepayment_type_manager'))
        ]"/>
    </record>

</odoo>