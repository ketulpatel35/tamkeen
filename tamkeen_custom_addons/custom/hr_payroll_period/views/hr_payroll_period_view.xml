<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

        <!-- Submenu for advanced views -->
        <menuitem name="Advanced"
                  id="menu_payroll_advanced"
                  parent="hr_payroll.menu_hr_payroll_root"
                  sequence="100" groups="hr_payroll.group_hr_payroll_user"/>
        <!-- Submenu for advanced views -->


        <!-- Move the following menu items from the payroll root menu to the advanced one -->
        <menuitem action="hr_payroll.action_view_hr_payslip_form"
                  id="hr_payroll.menu_department_tree" parent="menu_payroll_advanced" sequence="10"/>
        <menuitem action="hr_payroll.action_hr_payslip_run_tree"
                  id="hr_payroll.menu_hr_payslip_run" parent="menu_payroll_advanced" groups="hr_payroll.group_hr_payroll_user" sequence="20"/>
        <!-- Move 'Payroll Register' from hr_payroll_register -->
        <menuitem action="hr_payroll_register.open_payroll_registers"
                  id="hr_payroll_register.menu_payroll_register" parent="menu_payroll_advanced"
                  groups="hr_payroll.group_hr_payroll_user"
                  sequence="30"/>

        <!-- Payroll Period -->
        <record id="view_payroll_period_tree" model="ir.ui.view">
            <field name="name">hr.payroll.period.tree</field>
            <field name="model">hr.payroll.period</field>
            <field name="arch" type="xml">
                <tree string="Payroll Periods">
                    <field name="name"/>
                    <field name="date_start"/>
                    <field name="date_end"/>
                    <field name="state"/>
                </tree>
            </field>
        </record>
        <record id="view_payroll_period_form" model="ir.ui.view">
            <field name="name">hr.payroll.period.form</field>
            <field name="model">hr.payroll.period</field>
            <field name="arch" type="xml">
                <form string="Payroll Period" >
                    <header>
                        <field name="state" widget="statusbar" readonly="1"/>
                    </header>
                    <sheet>
                        <group>
                            <group>
                                <field name="name" required="1"/>
                                <!--<field name="schedule_id" />-->
                                <label for="date_start" string="Interval"/>
                                <div>
                                    <field name="date_start" nolabel="1"
                                           class="oe_inline" required="1"/> -
                                    <field name="date_end" nolabel="1"
                                           class="oe_inline" required="1"
                                           attrs="{'readonly': [('state','in',('close'))]}"/>
                                </div>
                                <!--<field name="register_id"-->
                                <!--attrs="{'readonly': [('state','!=','generate')]}"/>-->
                            </group>
                            <group colspan="4" col="4">
                                <field name="last_lock_date" readonly="1"/>
                                <field name="last_payroll_run_date" readonly="1"/>
                            </group>
                        </group>
                        <div class="oe_chatter">
                            <field name="message_follower_ids" widget="mail_followers"/>
                            <field name="message_ids" widget="mail_thread"/>
                        </div>
                    </sheet>
                </form>
            </field>
        </record>
        <record id="open_payroll_period_view" model="ir.actions.act_window">
            <field name="name">Payroll Periods</field>
            <field name="res_model">hr.payroll.period</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
        </record>
        <menuitem action="open_payroll_period_view"
                  id="menu_payroll_period_view"
                  parent="hr_payroll.menu_hr_payroll_root"

                  sequence="1"/>

        <!-- Pay Slip Amendment -->
        <record id="view_hr_payslip_amendment_tree" model="ir.ui.view">
            <field name="name">hr.payslip.amendment.tree.inherit</field>
            <field name="model">hr.payslip.amendment</field>
            <field name="inherit_id" ref="hr_payslip_amendment.view_payslip_amendment_tree"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='employee_id']" position="after">
                    <field name="pay_period_id"/>
                </xpath>
            </field>
        </record>
        <record id="view_hr_payslip_amendment_form" model="ir.ui.view">
            <field name="name">hr.payslip.amendment.form.inherit</field>
            <field name="model">hr.payslip.amendment</field>
            <field name="inherit_id" ref="hr_payslip_amendment.view_payslip_amendment_form"/>
            <field name="arch" type="xml">
                <xpath expr="//button[@name='do_validate']" position="before">
                    <button name="do_generate" class="oe_highlight"
                            states="draft" type="object" string="Generate"
                            groups="hr.group_hr_manager"/>
                </xpath>
                <xpath expr="//sheet/notebook/page[@name='note']"
                       position="after">
                    <page string="Payroll Period" name="payroll_period">
                        <group col="4" colspan="4">
                            <field name="parent_id" attrs="{'readonly':[('state','!=','draft')]}"/>
                            <field name="batch"
                                   attrs="{'invisible':[('parent_id','!=',False)], 'readonly':[('state','!=','draft')]}"/>
                            <field name="pay_period_id"
                                   attrs="{'readonly':[('state','!=','draft')]}" required="1"/>
                            <field name="end_period_id" attrs="{'readonly':[('state','!=','draft')], 'invisible':[('batch','=',False)], 'required':[('batch','=',True)]}"/>
                        </group>
                    </page>
                </xpath>
            </field>
        </record>

        <record model="ir.ui.view" id="hr_payslip_payroll_period_inherit">
            <field name="name">hr.payslip.payroll.period.additon</field>
            <field name="model">hr.payslip</field>
            <field name="inherit_id" ref="hr_payroll.view_hr_payslip_form" />
            <field name="arch" type="xml">
                <div class="oe_title" position="after">
                    <group>
                        <field name="payroll_period_id" required="1"/>
                    </group>
                </div>
            </field>
        </record>

        <record id="hr_payroll.action_view_hr_payslip_form"
                model="ir.actions.act_window">
            <field name="context">{'readonly_by_pass': True}</field>
        </record>


    </data>
</odoo>
