<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="project_management_view_task_form2_inherit" model="ir.ui.view">
        <field name="name">project.management.view.task.form2.inherit</field>
        <field name="model">project.task</field>
        <field eval="2" name="priority"/>
        <field name="inherit_id" ref="project.view_task_form2"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='date_deadline']"
                   position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
             <xpath expr="//field[@name='user_id']" position="before">
                 <field name="main_assignment"/>
                 <field name="assigned_to_external"
                        attrs="{'required': [('main_assignment','=','external')]}"/>
             </xpath>
            <xpath expr="//form/sheet/notebook/page[2]" position="attributes">
                <attribute name="groups">base.group_no_one</attribute>
            </xpath>

            <xpath expr="//field[@name='user_id']"
                   position="attributes">
                <attribute name="required">1</attribute>
                <attribute name="string">Assigned To (Internal)</attribute>
                <attribute name="options">{'no_create': True,'no_quick_create':True,'no_create_edit':True,'limit':1000}</attribute>
            </xpath>
            <xpath expr="//field[@name='project_id']" position="attributes">
                <attribute name="required">1</attribute>
                <attribute name="readonly">1</attribute>
            </xpath>
            <xpath expr="//form/sheet/notebook/page[@name='description_page']"
                   position="before">
                <page string="Schedule" name="schedule">
                    <group col="4" colspan="4">
                        <field name="start_date"/>
                        <field name="date_deadline" string="Due Date"/>
                        <field name="excepted_end_date"/>
                        <field name="actual_end_date"/>
                        <field name="days_to_assign" readonly="1"/>
                        <field name="days_to_close" readonly="1"/>
                        <field name="planned_hours"/>
                        <field name="days_since_last_action"/>
                        <field name="days_of_delay"/>
                    </group>

                </page>

            </xpath>
            <xpath  expr="//form/sheet/group[1]" position="after">
                <group col="4" colspan="4" >
                    <field name="working_hours_to_assign_the_task" invisible="1"/>
                    <field name="working_hours_to_close_the_task"
                           invisible="1"/>
                    <field name="task_completion_progress"/>
                    <field name="severity"/>
                </group>
            </xpath>

            <field name="kanban_state" position="after">
                <div class="oe_title">
                    <h1 class="o_row">
                        <field name="code" readonly="1"/>
                    </h1>
                </div>
            </field>
        </field>
    </record>

    <!-- Project task Search View -->
    <record id="view_task_search_form_inherited" model="ir.ui.view">
        <field name="name">project.task.search.form</field>
        <field name="model">project.task</field>
        <field name="inherit_id" ref="project.view_task_search_form"/>
        <field name="arch" type="xml">
            <field name="name" position="before">
                <field name="code" string="Code"/>
            </field>
        </field>
    </record>
    <!--project task inherit for hide planned hours and add in schedule tab-->
    <record model="ir.ui.view" id="view_task_form3_inherited">
        <field name="name">project.task.form.inherited</field>
        <field name="model">project.task</field>
        <field name="inherit_id" ref="hr_timesheet.view_task_form2_inherited" />
        <field name="arch" type="xml">
            <field name="planned_hours" position="attributes">
                <attribute name="invisible">1</attribute>
            </field>
        </field>
    </record>

    <!--project task tree inherit for add progress field-->
    <record model="ir.ui.view" id="view_task_tree3_inherited">
        <field name="name">project.task.tree.inherited</field>
        <field name="model">project.task</field>
        <field name="inherit_id" ref="hr_timesheet.view_task_tree2_inherited" />
        <field name="arch" type="xml">
            <field name="progress" position="attributes">
                <attribute name="invisible">1</attribute>
            </field>
            <field name="stage_id" position="before">
                <field name="task_completion_progress"  widget="progressbar"/>
            </field>
        </field>
    </record>

    <record id="project_management_view_task_tree_inherit" model="ir.ui.view">
        <field name="name">project.management.view.task.tree.inherit</field>
        <field name="model">project.task</field>
        <field name="inherit_id" ref="project.view_task_tree2"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='name']" position="before">
                <field name="code"/>
            </xpath>
        </field>
    </record>

    <record id="project.action_view_task" model="ir.actions.act_window">
        <field name="context">{'search_default_project': 1}</field>
        <field name="view_ids"
               eval="[(5, 0, 0),
                          (0, 0, {'view_mode': 'tree', 'view_id': ref('project.view_task_tree2')}),
                          (1, 0, {'view_mode': 'form', 'view_id': ref('project.view_task_form2')}),
                          (2, 0, {'view_mode': 'kanban', 'view_id': ref('project.view_task_kanban')}),
                          ]"
        />
    </record>

    <!-- Smart button default tree view -->
    <record id="project.act_project_project_2_project_task_all"
            model="ir.actions.act_window">
        <field name="view_mode">tree,kanban,form,calendar,pivot,graph</field>
    </record>

</odoo>
